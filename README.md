# 心理量表网络分析 Shiny 应用

## 简介

这是一个基于 `toturial.R` 开发的交互式网络分析工具，专门用于心理量表数据的多层级网络可视化。应用支持常见的心理量表（如 AUDIT、HRF、PHQ 等）的自动识别和分析。

## 核心功能

### 🔍 多层级网络分析
- **汇总层**：使用量表总分或维度得分构建网络
- **子量表层**：基于各个维度得分的网络结构
- **条目层**：原始题目级别的详细网络关系

### 📊 自动量表识别
支持以下心理量表的自动识别：
- **AUDIT**: 酒精使用障碍识别测试
- **HRF**: 习惯-奖赏-恐惧动机量表
- **PHQ-9**: 患者健康问卷抑郁量表
- **GAD-7**: 广泛性焦虑量表
- **BDI-II**: 贝克抑郁量表第二版
- **DASS-21**: 抑郁焦虑压力量表
- **IAT**: 网络成瘾测试
- **FTND**: 法格斯特姆烟草依赖测试

### 🛡️ 数据质量保证
- 自动数据验证和质量检查
- 缺失值处理和异常值检测
- 样本量和完整性评估

### 📈 全面的网络分析
- 网络结构可视化
- 中心性指标分析（强度、接近性、介数）
- Bootstrap 稳定性检验
- 交互式参数调整

### 💾 结果导出
- 高质量网络图导出
- 分析数据下载
- HTML 格式分析报告

## 安装和运行

### 1. 环境准备

确保已安装 R (≥ 4.0.0) 和必要的包：

```r
# 安装基础包
install.packages(c("shiny", "shinydashboard", "shinyWidgets", 
                   "DT", "plotly", "readxl", "dplyr", "ggplot2", "bruceR"))

# 安装 quickNet (从 GitHub)
if (!require(devtools)) install.packages("devtools")
devtools::install_github("LeiGuo0812/quickNet")

# 安装 Bioconductor 包
if (!require("BiocManager")) install.packages("BiocManager")
BiocManager::install("Rgraphviz")
```

### 2. 启动应用

```r
# 方法1：直接运行启动脚本（推荐）
source("run_app.R")

# 方法2：手动启动
shiny::runApp(".", port = 3838)
```

启动后，浏览器会自动打开应用界面：`http://127.0.0.1:3838`

## 数据格式要求

### 📁 支持的文件格式
- CSV 文件 (`.csv`)
- Excel 文件 (`.xlsx`, `.xls`)

### 📋 数据结构
- **行**：每行代表一个被试/参与者
- **列**：每列代表一个测量指标（题目或维度得分）

### 🏷️ 变量命名规范

为了自动识别量表结构，请遵循以下命名规范：

```
量表前缀_题目编号
```

**示例：**
- AUDIT量表：`AUDIT10_1`, `AUDIT10_2`, ..., `AUDIT10_10`
- HRF量表：`HRF18_1`, `HRF18_2`, ..., `HRF18_18`
- PHQ量表：`PHQ9_1`, `PHQ9_2`, ..., `PHQ9_9`

### 📊 数据质量要求
- 最小样本量：30 个被试
- 数据完整率：≥ 70%
- 单个变量缺失率：≤ 30%

## 使用流程

### 步骤 1: 数据上传
1. 点击"数据上传"标签页
2. 选择数据文件（CSV 或 Excel 格式）
3. 确认数据包含列名
4. 查看数据预览和质量检查结果

### 步骤 2: 网络分析
1. 点击"网络分析"标签页
2. 选择分析层级：
   - **汇总层**：适合探索总体关系模式
   - **子量表层**：适合研究维度间关系
   - **条目层**：适合详细的题目级分析
3. 调整分析参数：
   - 网络阈值（推荐 0.05）
   - Bootstrap 次数（推荐 1000-5000）
4. 点击"运行分析"

### 步骤 3: 结果解读
- **网络图**：节点大小表示中心性，边粗细表示关系强度
- **中心性分析**：识别网络中的核心节点
- **稳定性分析**：评估网络结构的可靠性

### 步骤 4: 结果下载
1. 点击"结果下载"标签页
2. 下载网络图、中心性图或完整报告

## 应用架构

```
NetworkApp/
├── app.R              # 主应用文件
├── config.R           # 配置文件（量表定义、参数设置）
├── utils.R            # 工具函数库
├── run_app.R          # 启动脚本
├── README.md          # 说明文档
└── example_data.csv   # 示例数据
```

### 核心模块

1. **数据处理模块** (`utils.R`)
   - 自动量表识别：`parse_scale_structure_advanced()`
   - 数据验证：`validate_data()`
   - 维度得分计算：`compute_scale_scores_advanced()`

2. **网络分析模块** (`utils.R`)
   - 安全网络分析：`safe_network_analysis()`
   - 结果导出：`export_analysis_results()`

3. **配置管理模块** (`config.R`)
   - 量表结构定义：`SCALE_CONFIGS`
   - 分析参数：`NETWORK_PARAMS`
   - 可视化配置：`VIZ_CONFIG`

## 量表配置

应用内置了多种心理量表的配置，包括：

### HRF 量表维度结构
```
Habit (习惯动机): 题目 3, 6, 7, 10, 14, 16
Reward (奖赏动机): 题目 2, 4, 9, 12, 15, 17  
Fear (恐惧动机): 题目 1, 5, 8, 11, 13, 18
```

### AUDIT 量表计分
```
题目 1-8: 0-4 分
题目 9-10: 0-4 分（权重 ×2）
总分范围: 0-40 分
```

## 故障排除

### 常见问题

1. **包安装失败**
   ```r
   # 尝试更换 CRAN 镜像
   options(repos = c(CRAN = "https://cran.r-project.org/"))
   
   # 或使用清华镜像
   options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
   ```

2. **quickNet 包无法安装**
   ```r
   # 检查网络连接，然后重试
   devtools::install_github("LeiGuo0812/quickNet", force = TRUE)
   ```

3. **数据无法识别**
   - 检查变量命名是否符合规范
   - 确保数据文件编码为 UTF-8
   - 验证数据格式和结构

4. **网络分析失败**
   - 检查样本量是否充足（≥30）
   - 验证变量方差是否为零
   - 确认数据完整性

### 性能优化

- 对于大数据集（>1000 被试），建议：
  - 减少 Bootstrap 次数到 1000
  - 在条目层分析时限制变量数量
  - 关闭稳定性分析以节省时间

## 技术支持

- **基础框架**: Shiny + shinydashboard
- **网络分析**: quickNet + qgraph
- **数据处理**: dplyr + readxl
- **可视化**: ggplot2 + plotly

## 更新日志

### v1.0.0 (2025-01-10)
- 初始版本发布
- 支持多层级网络分析
- 集成8种常见心理量表
- 完整的数据验证和质量控制
- 交互式分析界面

## 贡献指南

欢迎贡献代码或提出建议：

1. 量表配置扩展（在 `config.R` 中添加新量表）
2. 分析功能增强（在 `utils.R` 中添加新函数）
3. 界面优化建议
4. 错误报告和修复

## 许可证

本项目基于原始 `toturial.R` 开发，遵循相同的许可协议。

---

📧 **联系方式**: 如有问题请通过 GitHub Issues 反馈

🌟 **致谢**: 感谢 quickNet 包的开发团队和原始教学代码的作者