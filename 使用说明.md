# 🎯 网络分析应用使用说明

## 🚀 三种启动方法

### 方法一：最简单（推荐）
```r
source("启动应用.R")
```

### 方法二：完整版启动
```r
source("run_app.R")
```

### 方法三：直接启动
```r
shiny::runApp("app.R")
```

## 📋 具体操作步骤

### 第一步：准备环境
1. 打开 R 或 RStudio
2. 设置工作目录到 NetworkApp 文件夹：
   ```r
   setwd("你的路径/NetworkApp")
   ```
3. 运行启动脚本（选择上面任一方法）

### 第二步：访问应用
- 应用启动后会自动打开浏览器
- 如果没有自动打开，手动访问：**http://127.0.0.1:3838**

### 第三步：上传数据
1. 点击"数据上传"标签页
2. 选择你的数据文件（支持 CSV 和 Excel 格式）
3. 确保"包含列名"选项正确
4. 查看数据预览和量表识别结果

### 第四步：灵活选择分析层级 ✨
**这是新功能！现在你可以为每个量表单独选择层级：**

1. 点击"网络分析"标签页
2. 在左侧"各量表层级选择"区域，为每个量表选择：
   - **汇总层**：使用量表总分（推荐用于AUDIT等）
   - **子量表层**：使用各维度得分（如HRF的习惯、奖赏、恐惧）
   - **条目层**：使用原始题目得分（获得最详细信息）

**示例搭配：**
- AUDIT量表 → 汇总层（总分）
- HRF量表 → 条目层（18个题目）
- PHQ量表 → 子量表层（如果有子维度）

### 第五步：设置参数并分析
1. 调整网络阈值（推荐0.05）
2. 设置Bootstrap次数（推荐1000）
3. 点击"运行分析"

### 第六步：查看结果
- **网络图**：节点大小表示中心性，边的粗细表示关系强度
- **中心性分析**：识别最重要的节点
- **稳定性分析**：评估结果可靠性

## 🎯 灵活层级选择的优势

### 为什么这样设计？
- **AUDIT总分** vs **HRF条目**：总分体现整体严重程度，条目显示具体机制
- **混合层级**：在一个网络中同时看到宏观和微观关系
- **研究导向**：根据你的研究问题灵活配置

### 实际应用场景
1. **临床研究**：AUDIT总分 + 症状条目，看严重程度如何影响具体症状
2. **机制探索**：保持条目层级，深入了解题目间关系
3. **理论验证**：使用维度层级，验证理论模型

## 📊 数据格式要求

### 变量命名规范
```
AUDIT10_1, AUDIT10_2, ..., AUDIT10_10    # AUDIT量表
HRF18_1, HRF18_2, ..., HRF18_18         # HRF量表  
PHQ9_1, PHQ9_2, ..., PHQ9_9             # PHQ量表
```

### 支持的量表
- **AUDIT**：酒精使用障碍识别测试
- **HRF**：习惯-奖赏-恐惧动机量表
- **PHQ-9**：抑郁症状量表
- **GAD-7**：焦虑症状量表
- **其他**：按前缀自动识别

## ⚠️ 常见问题解决

### 1. 应用无法启动
```r
# 检查是否在正确目录
getwd()

# 重新设置目录
setwd("完整路径/NetworkApp")

# 重新运行
source("启动应用.R")
```

### 2. 包安装失败
```r
# 更换镜像
options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))

# 重新安装
install.packages("包名")
```

### 3. 数据无法识别
- 检查变量命名是否符合规范
- 确保数据包含列名
- 验证文件编码（推荐UTF-8）

### 4. 网络分析失败
- 检查样本量（建议≥50）
- 确认数据完整性（缺失值<30%）
- 降低网络阈值或减少变量数

## 💡 使用技巧

### 层级选择建议
- **初次探索**：所有量表都选汇总层，获得简洁的整体图景
- **深入分析**：核心量表选条目层，辅助量表选汇总层
- **机制研究**：相关量表都选条目层，揭示详细关系

### 参数优化
- **小样本**（<100）：降低阈值到0.01，减少Bootstrap次数
- **大样本**（>500）：可以提高阈值到0.1，增加Bootstrap次数
- **多变量**（>30）：考虑分批分析或提高阈值

## 📞 获取帮助

如果遇到问题：
1. 查看控制台错误信息
2. 检查数据格式和命名
3. 重启应用再次尝试

---
✨ **新特性**：灵活的层级选择让你可以根据研究需要，为不同量表选择最合适的分析层级！